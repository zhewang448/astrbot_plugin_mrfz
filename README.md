# 明日方舟角色语音插件 astrbot_plugin_mrfz

## v3.4.1

这是一个支持明日方舟所有角色、所有皮肤、全语言语音的 AstrBot 插件。
内置了 PRTS 终端风格的图片渲染引擎，支持模糊匹配和自定义语音绑定。

## 访问统计

<a href="https://count.getloli.com/"><img src="https://count.getloli.com/get/@:astrbot_plugin_mrfz?theme=rule34"></a>

## ✨ 功能特点

- **全语音支持**：涵盖 中文(普通话/方言)、日语、英语、韩语、意大利语。
- **智能模糊匹配**：输错角色名也能自动识别（如 `/mrfz 阿米亚` -> 自动识别为 `阿米娅`）。
- **精美可视化**：生成 PRTS 终端风格的帮助菜单和干员列表。
- **自定义绑定**：可以将任意语音绑定到简短的触发词（如 `早安` -> `阿米娅 问候`）。
- **自动资源管理**：自动下载语音、自动爬取干员头像。
- **HTML 导出**：支持生成本地 HTML 格式的语音列表报表。

## 🛠️ 指令说明

| 指令                                       | 别名           | 功能说明                                                                                                                                               |
| :----------------------------------------- | :------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------- |
| `/mrfz [角色] [语音] [语言]`               | `方舟语音`     | **核心指令**。<br>• **角色**：支持模糊匹配。<br>• **语音**：不填则随机。<br>• **语言**：不填则按配置优先级自动选择。<br>📝 _示例：`/mrfz 凯尔希 问候`_ |
| `/mrfz_list`                               | `方舟语音列表` | 生成当前已下载语音的干员列表卡片，包含头像、已下载语言和自定义指令概览。                                                                               |
| `/mrfz_fetch [角色]`                       | `下载语音`     | 从 PRTS Wiki 下载指定干员的所有语音数据（含皮肤）。<br>📝 _示例：`/mrfz_fetch 陈`_                                                                     |
| `/mrfz_bind [触发词] [角色] [语音] [语言]` | `绑定语音`     | 将一句语音绑定到特定的触发词。<br>📝 _示例：`/mrfz_bind 晚安 凯尔希 问候`_<br>之后只需发送 `晚安` 即可播放。                                           |
| `/mrfz_unbind [触发词]`                    | `解绑语音`     | 解除指定的快捷触发词绑定。                                                                                                                             |
| `/mrfz_help`                               | `方舟语音帮助` | 生成可视化的帮助图片。                                                                                                                                 |

## ⚙️ 配置项

配置文件位于 AstrBot 控制面板：

| 配置项                   | 类型   | 默认值     | 说明                                                                      |
| :----------------------- | :----- | :--------- | :------------------------------------------------------------------------ |
| `auto_download`          | bool   | `true`     | 未找到角色语音时，是否尝试自动下载。                                      |
| `auto_download_skin`     | bool   | `true`     | 下载时是否包含皮肤语音。                                                  |
| `default_language_rank`  | string | `"123456"` | 播放时的语言优先级。<br>1:方言, 2:中文, 3:日语, 4:英语, 5:韩语, 6:意语    |
| `auto_download_language` | string | `"123"`    | 执行下载指令时，默认下载哪些语言（代码同上）。                            |
| `html_render_mode`       | bool   | `false`    | 是否在生成列表图片的同时，在本地生成 `list.html` 文件，方便从浏览器查看。 |

## 📂 目录结构

### 1. 插件安装目录

位于 `AstrBot/data/plugins/astrbot_plugin_mrfz/`：

```text
astrbot_plugin_mrfz/
├── main.py                 # 核心入口
├── data_source.py          # 数据源与下载逻辑
├── renderer.py             # 图片渲染模块
├── SourceHanSerifCN...otf  # 字体文件
├── help.png                # (自动生成) 帮助图片缓存
├── list.png                # (自动生成) 列表图片缓存
└── requirements.txt        # 依赖列表
```

2. 插件数据目录
   位于`AstrBot/data/plugin_data/astrbot_plugin_mrfz/`：

```
astrbot_plugin_mrfz/
├── assets/                 # [自动生成] 干员头像缓存目录
│   ├── 阿米娅.png
│   └── ...
├── voices/                 # [自动生成] 语音文件存储目录
│   └── 阿米娅/
│       ├── cn/             # 中文语音
│       ├── jp/             # 日语语音
│       └── skin/           # 皮肤语音目录
├── custom_commands.json    # [自动生成] 自定义绑定数据
├── voice_index.json        # [自动生成] 本地语音索引缓存
└── _conf_schema.json       # 配置文件
```

## 📅 更新日志

### v3.4.1

- **新增**：自定义语音显示语言。
- **优化**：增加运行效率。

### v3.4.0

- **新增**：模糊匹配功能，输错名字也能智能识别。
- **新增**：自定义指令绑定功能 (`/mrfz_bind`)，数据持久化保存。
- **优化**：重构渲染模块，列表图片包含干员头像，样式升级为 Dark Mode 风格。
- **优化**：代码结构分离为 `Data` / `Renderer` / `Main`，提升维护性。
- **修复**：Linux 环境下字体路径导致的崩溃问题（优先读取插件目录字体）。

### v3.3.7

- 修复了在部分场景下字体失效的问题。

### v3.3.3

- 支持全语言（英/韩/意）。
- 优化下载逻辑。

## ⚠️ 注意事项

1. **资源来源**：所有语音和图片资源实时爬取自 [PRTS Wiki](https://prts.wiki/)，请遵守相关使用协议。
2. **网络问题**：批量下载语音时请确保网络通畅，以免下载不完整。
3. **文件删除**：可自行在`\data\plugin_data\astrbot_plugin_mrfz\voices\`目录下删除不需要的语音文件，并在之后重载插件。

## 📄 许可证

MIT

## ⭐ Stars

> [!TIP]
> 如果本项目对您的生活 / 工作产生了帮助，或者您关注本项目的未来发展，请给项目 Star，这是我维护这个开源项目的动力 <3
